<!--
  ============================================================
    INTEGRATION GAP (A1, A2) – HUD ↔ RV-APP
  ------------------------------------------------------------
    • HUD does NOT embed <rv-app>.
    • HUD originally had NO link/button to open rv-app.
    • No <iframe>, no <rv-app> element.
    • Users could NOT reach rv-app unless typing the URL manually.
    • This was the root cause of the A1/A2 FAIL states.

    RESOLUTION:
    • Navigation must happen via an explicit button
      (e.g. “Open Workahol Enabler”).
  ============================================================
-->

<!--
  NOTE (A9 FAIL):
    HUD does NOT call /api/clips or show clip library UI.
    Only rv-app has a Library page, and it displays local mnemonics only.
-->

<!-- NOTE: HUD never calls /api/clips. -->

<!--
  ------------------------------------------------------------
    WIRING ASSERTION A7 – PASS
    (No CSP / No X-Frame-Options)
  ------------------------------------------------------------
    • This HTML file does NOT include:
        <meta http-equiv="Content-Security-Policy">
    • Servers do NOT send:
        X-Frame-Options: DENY
        X-Frame-Options: SAMEORIGIN

    Meaning:
      iframe embedding is NOT blocked.
      rv-app *could* be embedded if desired.
  ------------------------------------------------------------
-->

<!--
  ============================================================
    WIRING ASSERTIONS A1 + A2 – DOCUMENTATION
  ------------------------------------------------------------
    A1 (HUD contains an <iframe>): FAIL
      - The HUD renders native video playback and metrics directly inside the page.
      - There is NO <iframe>.
      - Video is embedded via a <video> element inside #video-player.

    A2 (HUD links to rv-app): FAIL (original state)
      - HUD did NOT contain:
            • <rv-app>
            • a navigation link
            • an iframe pointing to /rv
      - rv-app was an isolated application until the
        “Open Workahol Enabler” button was later added manually.

    Reason for Design:
      - HUD stays lightweight for overlays, step counters, playlists.
      - rv-app is a *separate full studio* and not mounted inside HUD.
      - Linking is intentional and happens externally, not via embedding.
  ============================================================
-->

<!--
  ============================================================
    HUD ROUTING & NAVIGATION – PROJECT MAP
  ------------------------------------------------------------
    - This is the HUD homepage shown inside Electron.
    - Provides:
        * Google Auth
        * Video playlist controls
        * Step counter and telemetry
        * HUD visibility toggles
        * Passport export

    - IMPORTANT:
        * This page DOES NOT embed <rv-app>.
        * rv-app is a separate application served at /rv.
        * Navigation is intentionally done via a button:
              “Open Workahol Enabler”
        * rv-app lives in rv-app/public/index.html and mounts <rv-app>.

    - Reason:
        * To keep HUD runtime lightweight and avoid mixing two UIs.
        * rv-app is a full learning studio; HUD is a minimal overlay.
  ============================================================
-->

<!--
  ============================================================
  HUD (renderer/) – PROJECT MAP
  ------------------------------------------------------------
  Role:
    - This is the web-based heads-up display (HUD) shown inside Electron.
    - Contains video controls, playlist manager, step counter,
      telemetry status, Google Fit integration, and passport export.

  Structure:
    index.html       → Loads HUD layout + scripts
    renderer.js      → Main HUD logic (video playback, Fit, playlists)
    passport.js      → Passport export/logic
    style.css        → Static HUD styling (no bundler)
    package.json     → HUD-specific metadata (no build step)

  Notes:
    - No bundler, no Vite/Webpack. Everything is served as static files.
    - HUD is distinct from rv-app (learning studio).
    - Renderer receives data but does not compile, bundle, or transform it.
  ============================================================
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Ballpoint ink SVG filter -->
    <svg width="0" height="0" style="position: absolute; pointer-events: none;" aria-hidden="true">
      <defs>
        <filter id="ballpoint-ink" x="-5%" y="-5%" width="110%" height="110%" color-interpolation-filters="sRGB">
          <feTurbulence type="fractalNoise" baseFrequency="0.25 0.35" numOctaves="2" seed="11" result="paperGrain" />
          <feComponentTransfer in="paperGrain" result="inkFlow">
            <feFuncR type="table" tableValues="0.48 0.52 0.56" />
            <feFuncG type="table" tableValues="0.48 0.52 0.56" />
            <feFuncB type="table" tableValues="0.48 0.52 0.56" />
          </feComponentTransfer>
          <feDisplacementMap in="SourceGraphic" in2="inkFlow" scale="0.65" xChannelSelector="R" yChannelSelector="G" result="waveredInk" />
          <feGaussianBlur in="waveredInk" stdDeviation="0.35" result="featheredInk" />
          <feComponentTransfer in="featheredInk" result="inked">
            <feFuncR type="gamma" amplitude="0.98" exponent="0.9" offset="0" />
            <feFuncG type="gamma" amplitude="0.98" exponent="0.9" offset="0" />
            <feFuncB type="gamma" amplitude="0.98" exponent="0.9" offset="0" />
            <feFuncA type="table" tableValues="0 0.16 0.42 0.78 1" />
          </feComponentTransfer>
          <feComposite in="inked" in2="inkFlow" operator="arithmetic" k1="0" k2="1" k3="0.08" k4="0" result="finalInk" />
        </filter>
      </defs>
    </svg>
    <title>RunnyVision HUD</title>
    <link rel="stylesheet" href="style.css?v=13" />
  </head>
  <body data-google-client-id="your-google-client-id.apps.googleusercontent.com">
    <!-- Import ballpoint ink filter for notebook aesthetic on labels -->
    <svg width="0" height="0" style="position: absolute; pointer-events: none;" aria-hidden="true">
      <defs>
        <filter id="ballpoint-ink" x="-5%" y="-5%" width="110%" height="110%" color-interpolation-filters="sRGB">
          <feTurbulence type="fractalNoise" baseFrequency="0.25 0.35" numOctaves="2" seed="11" result="paperGrain" />
          <feComponentTransfer in="paperGrain" result="inkFlow">
            <feFuncR type="table" tableValues="0.48 0.52 0.56" />
            <feFuncG type="table" tableValues="0.48 0.52 0.56" />
            <feFuncB type="table" tableValues="0.48 0.52 0.56" />
          </feComponentTransfer>
          <feDisplacementMap in="SourceGraphic" in2="inkFlow" scale="0.65" xChannelSelector="R" yChannelSelector="G" result="waveredInk" />
          <feGaussianBlur in="waveredInk" stdDeviation="0.35" result="featheredInk" />
          <feComponentTransfer in="featheredInk" result="inked">
            <feFuncR type="gamma" amplitude="0.98" exponent="0.9" offset="0" />
            <feFuncG type="gamma" amplitude="0.98" exponent="0.9" offset="0" />
            <feFuncB type="gamma" amplitude="0.98" exponent="0.9" offset="0" />
            <feFuncA type="table" tableValues="0 0.16 0.42 0.78 1" />
          </feComponentTransfer>
          <feComposite in="inked" in2="inkFlow" operator="arithmetic" k1="0" k2="1" k3="0.08" k4="0" result="finalInk" />
        </filter>
      </defs>
    </svg>

    <div id="main-actions" style="position: fixed; top: 20px; right: 20px; z-index: 10;">
      <button
        id="open-hallucination-controls"
        class="frame-rect"
        type="button"
        title="Open HUD controls"
        aria-label="Open HUD controls"
      >HUD</button>
    </div>

    <div id="video-player-container">
      <video id="v1" class="atom-video active" muted playsinline aria-label="Video layer 1"></video>
      <video id="v2" class="atom-video" muted playsinline aria-label="Video layer 2"></video>
      <div id="video-controls" aria-label="Video controls">
        <button id="video-play" type="button" class="frame-rect">Play</button>
        <button id="video-pause" type="button" class="frame-rect" title="Pause atom engine playback">Pause</button>
        <button id="video-stop" type="button" class="frame-rect" title="Stop atom engine playback">Stop</button>
      </div>
    </div>

    <div id="fx-overlay" aria-hidden="true"></div>

    <script type="module">
      // Convert HUD buttons to hand-drawn SVG - runs immediately, before other scripts
      import { createHandDrawnButton } from './hand-drawn-rect.js';
      
      // Replace buttons synchronously as soon as this script loads (runs inline during parse)
      const buttons = document.querySelectorAll('#hud button, #video-controls button, #main-actions button');
      buttons.forEach(btn => {
        const text = btn.textContent.trim();
        const seed = text.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
        
        const svg = createHandDrawnButton(text, { 
          width: 110, 
          height: 28,
          seed: seed,
        });
        
        // Copy attributes to SVG but NOT className (to avoid CSS background conflicts)
        if (btn.id) svg.id = btn.id;
        if (btn.type) svg.setAttribute('data-type', btn.type);
        svg.classList.add('hand-drawn-button'); // Mark as hand-drawn
        if (btn.disabled) {
          svg.setAttribute('data-disabled', 'true');
          svg.style.opacity = '0.5';
          svg.style.pointerEvents = 'none';
        }
        if (btn.title) svg.setAttribute('title', btn.title);
        Array.from(btn.attributes).forEach(attr => {
          if (attr.name.startsWith('data-') || attr.name.startsWith('aria-')) {
            svg.setAttribute(attr.name, attr.value);
          }
        });
        
        svg.style.display = 'inline-block';
        svg.style.verticalAlign = 'middle';
        
        btn.parentNode.replaceChild(svg, btn);
      });
    </script>

    <script type="module">
      import { downloadLog } from './sessionLogger.js';
      window.downloadSessionLog = downloadLog;
    </script>
    
    <script src="renderer.js?v=17" type="module"></script>
  </body>
</html>
